import{bind,clear}from"size-sensor";import{requestAnimationFrame,cancelAnimationFrame,range,canvasStyle}from"./utils";export default class CanvasNest{static version=__VERSION__;constructor(t,e){this.el=t,this.c={zIndex:-1,opacity:.5,color:"0,0,0",pointColor:"0,0,0",count:99,...e},this.canvas=this.newCanvas(),this.context=this.canvas.getContext("2d"),this.points=this.randomPoints(),this.current={x:null,y:null,max:2e4},this.all=this.points.concat([this.current]),this.bindEvent(),this.requestFrame(this.drawCanvas)}bindEvent(){bind(this.el,()=>{this.canvas.width=this.el.clientWidth,this.canvas.height=this.el.clientHeight}),this.onmousemove=window.onmousemove,window.onmousemove=t=>{this.current.x=t.clientX-this.el.offsetLeft+document.scrollingElement.scrollLeft,this.current.y=t.clientY-this.el.offsetTop+document.scrollingElement.scrollTop,this.onmousemove&&this.onmousemove(t)},this.onmouseout=window.onmouseout,window.onmouseout=()=>{this.current.x=null,this.current.y=null,this.onmouseout&&this.onmouseout()}}randomPoints=()=>range(this.c.count).map(()=>({x:Math.random()*this.canvas.width,y:Math.random()*this.canvas.height,xa:2*Math.random()-1,ya:2*Math.random()-1,max:6e3}));newCanvas(){"static"===getComputedStyle(this.el).position&&(this.el.style.position="relative");var t=document.createElement("canvas");return t.style.cssText=canvasStyle(this.c),t.width=this.el.clientWidth,t.height=this.el.clientHeight,this.el.appendChild(t),t}requestFrame(t){this.tid=requestAnimationFrame(()=>t.call(this))}drawCanvas(){let s=this.context,i=this.canvas.width,n=this.canvas.height,o=this.current;var t=this.points;let a=this.all;s.clearRect(0,0,i,n);let h,l,r,c,m,u;t.forEach((t,e)=>{for(t.x+=t.xa,t.y+=t.ya,t.xa*=t.x>i||t.x<0?-1:1,t.ya*=t.y>n||t.y<0?-1:1,s.fillStyle=`rgba(${this.c.pointColor})`,s.fillRect(t.x-.5,t.y-.5,1,1),l=e+1;l<a.length;l++)null!==(h=a[l]).x&&null!==h.y&&(c=t.x-h.x,m=t.y-h.y,(u=c*c+m*m)<h.max)&&(h===o&&u>=h.max/2&&(t.x-=.03*c,t.y-=.03*m),r=(h.max-u)/h.max,s.beginPath(),s.lineWidth=r/2,s.strokeStyle=`rgba(${this.c.color},${r+.2})`,s.moveTo(t.x,t.y),s.lineTo(h.x,h.y),s.stroke())}),this.requestFrame(this.drawCanvas)}destroy(){clear(this.el),window.onmousemove=this.onmousemove,window.onmouseout=this.onmouseout,cancelAnimationFrame(this.tid),this.canvas.parentNode.removeChild(this.canvas)}}