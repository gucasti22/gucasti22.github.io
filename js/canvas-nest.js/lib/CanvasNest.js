Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},_createClass=(()=>{function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}})(),_sizeSensor=require("size-sensor"),_utils=require("./utils");function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var CanvasNest=(()=>{function o(t,e){var n=this;_classCallCheck(this,o),this.randomPoints=function(){return(0,_utils.range)(n.c.count).map(function(){return{x:Math.random()*n.canvas.width,y:Math.random()*n.canvas.height,xa:2*Math.random()-1,ya:2*Math.random()-1,max:6e3}})},this.el=t,this.c=_extends({zIndex:-1,opacity:.5,color:"0,0,0",pointColor:"0,0,0",count:99},e),this.canvas=this.newCanvas(),this.context=this.canvas.getContext("2d"),this.points=this.randomPoints(),this.current={x:null,y:null,max:2e4},this.all=this.points.concat([this.current]),this.bindEvent(),this.requestFrame(this.drawCanvas)}return _createClass(o,[{key:"bindEvent",value:function(){var e=this;(0,_sizeSensor.bind)(this.el,function(){e.canvas.width=e.el.clientWidth,e.canvas.height=e.el.clientHeight}),this.onmousemove=window.onmousemove,window.onmousemove=function(t){e.current.x=t.clientX-e.el.offsetLeft+document.scrollingElement.scrollLeft,e.current.y=t.clientY-e.el.offsetTop+document.scrollingElement.scrollTop,e.onmousemove&&e.onmousemove(t)},this.onmouseout=window.onmouseout,window.onmouseout=function(){e.current.x=null,e.current.y=null,e.onmouseout&&e.onmouseout()}}},{key:"newCanvas",value:function(){"static"===getComputedStyle(this.el).position&&(this.el.style.position="relative");var t=document.createElement("canvas");return t.style.cssText=(0,_utils.canvasStyle)(this.c),t.width=this.el.clientWidth,t.height=this.el.clientHeight,this.el.appendChild(t),t}},{key:"requestFrame",value:function(t){var e=this;this.tid=(0,_utils.requestAnimationFrame)(function(){return t.call(e)})}},{key:"drawCanvas",value:function(){var n=this,o=this.context,i=this.canvas.width,s=this.canvas.height,a=this.current,t=this.points,r=this.all,l=(o.clearRect(0,0,i,s),void 0),u=void 0,c=void 0,h=void 0,v=void 0,m=void 0;t.forEach(function(t,e){for(t.x+=t.xa,t.y+=t.ya,t.xa*=i<t.x||t.x<0?-1:1,t.ya*=s<t.y||t.y<0?-1:1,o.fillStyle="rgba("+n.c.pointColor+")",o.fillRect(t.x-.5,t.y-.5,1,1),u=e+1;u<r.length;u++)null!==(l=r[u]).x&&null!==l.y&&(h=t.x-l.x,v=t.y-l.y,(m=h*h+v*v)<l.max)&&(l===a&&m>=l.max/2&&(t.x-=.03*h,t.y-=.03*v),c=(l.max-m)/l.max,o.beginPath(),o.lineWidth=c/2,o.strokeStyle="rgba("+n.c.color+","+(c+.2)+")",o.moveTo(t.x,t.y),o.lineTo(l.x,l.y),o.stroke())}),this.requestFrame(this.drawCanvas)}},{key:"destroy",value:function(){(0,_sizeSensor.clear)(this.el),window.onmousemove=this.onmousemove,window.onmouseout=this.onmouseout,(0,_utils.cancelAnimationFrame)(this.tid),this.canvas.parentNode.removeChild(this.canvas)}}]),o})();CanvasNest.version="2.0.4",exports.default=CanvasNest,module.exports=exports.default;